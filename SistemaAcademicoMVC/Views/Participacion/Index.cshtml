@model PagedList.IPagedList<SistemaAcademicoMVC.Models.Participacion>
@using PagedList.Mvc;
@{
    ViewBag.Title = "Listado de Participaciones";
    var cursos = ViewBag.Cursos as List<SelectListItem>; // lista de cursos para filtro
}

<!-- Filtro por curso y búsqueda -->
<form method="get" class="form-inline mb-3">
    <div class="form-group mr-2">
        <label for="cursoId">Curso:</label>
        @Html.DropDownList("cursoId", cursos, "Todos", new { @class = "form-control ml-2", id = "cursoId" })
    </div>
    <div class="form-group mr-2">
        <label for="search">Buscar:</label>
        <input type="text" name="search" value="@Request["search"]" class="form-control ml-2" placeholder="Nombre estudiante, descripción..." />
    </div>
    <button type="submit" class="btn btn-primary">Filtrar</button>
    <a href="@Url.Action("Index")" class="btn btn-secondary ml-2">Limpiar</a>
</form>

<p>
    @Html.ActionLink("Registrar nueva participación", "Create", null, new { @class = "btn btn-primary" })
</p>

<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Estudiante</th>
            <th>Curso</th>
            <th>Fecha</th>
            <th>Asistió</th>
            <th>Descripción</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@(item.Matricula?.Estudiante?.Nombre ?? "Sin nombre")</td>
                <td>@(item.Matricula?.Curso?.Nombre ?? "Sin curso")</td>
                <td>@item.Fecha.ToString("yyyy-MM-dd")</td>
                <td>@(item.Asistio ? "Sí" : "No")</td>
                <td>@item.Descripcion</td>
            </tr>
        }
    </tbody>
</table>

<!-- Paginación -->
@if (Model.PageCount > 1)
{
    <div class="d-flex justify-content-center">
        @Html.PagedListPager(Model, page => Url.Action("Index", new { page, cursoId = Request["cursoId"], search = Request["search"] }),
            PagedListRenderOptions.Classic)
    </div>
}